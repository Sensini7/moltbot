# MoltBot EC2 Setup Guide
## Secure Deployment with WhatsApp Integration

> **Last Updated:** January 2026  
> **MoltBot Version:** Beta  
> **Author:** Based on Pulumi and Hostinger documentation

---

## Table of Contents

1. [What is MoltBot?](#what-is-moltbot)
2. [Prerequisites](#prerequisites)
3. [Architecture Overview](#architecture-overview)
4. [Setup Method 1: Pulumi (Infrastructure as Code)](#setup-method-1-pulumi)
5. [Setup Method 2: Bash Script (Manual Deployment)](#setup-method-2-bash-script)
6. [Setup Method 3: Terraform Alternative](#setup-method-3-terraform)
7. [Security Best Practices](#security-best-practices)
8. [Connecting to WhatsApp](#connecting-to-whatsapp)
9. [Post-Deployment Management](#post-deployment-management)
10. [Troubleshooting](#troubleshooting)

---

## What is MoltBot?

MoltBot (formerly Clawdbot) is an open-source AI assistant that runs on your own infrastructure. It's like having Jarvis from Iron Man, but running on your server instead of in the cloud.

**Key Features:**
- 24/7 availability on your own server
- Multi-platform support: WhatsApp, Slack, Discord, Telegram, Signal, iMessage
- Browser automation and web scraping capabilities
- Voice generation and video creation
- Scheduled tasks via cron
- Runs on anything: EC2, VPS, Raspberry Pi, Mac Mini

**Why Self-Host?**
- Full control over your data
- No reliance on third-party services
- Customizable and extensible
- Complete conversation history stored locally
- Works with Anthropic Claude, OpenAI, or local models

---

## Prerequisites

### Required Accounts & Keys

1. **AWS Account** with appropriate permissions
2. **Anthropic API Key** (recommended) OR OpenAI API key
   - Sign up at [console.anthropic.com](https://console.anthropic.com)
   - Navigate to API Keys section
   - Create a new key
   - **Important:** Requires active billing setup

3. **Tailscale Account** (for secure access)
   - Sign up at [tailscale.com](https://tailscale.com)
   - Enable HTTPS in admin console (one-time setup)
   - Generate an auth key

4. **WhatsApp Business Account** (for WhatsApp integration)

### Required Software

- **For Pulumi Method:**
  - Pulumi CLI installed
  - Node.js 18+
  - AWS CLI configured

- **For Bash/Terraform Methods:**
  - SSH client
  - Terraform (if using method 3)
  - Basic Linux knowledge

### Minimum Server Requirements

```yaml
Instance Type: t3.medium or larger (t3.micro is insufficient!)
Memory: 4GB minimum (8GB recommended)
Storage: 30GB minimum
Operating System: Ubuntu 24.04 LTS
Ports Required:
  - 22 (SSH - fallback)
  - 18789 (Gateway - via Tailscale only)
  - 18791 (Browser control - via Tailscale only)
```

⚠️ **Critical:** Do NOT use t3.micro (1GB RAM). Installation will fail. Use t3.medium (4GB) minimum.

---

## Architecture Overview

MoltBot uses a gateway-centric architecture:

```
┌─────────────────────────────────────────────────────┐
│                   EC2 Instance                       │
│                                                      │
│  ┌──────────────┐  ┌──────────────┐  ┌───────────┐ │
│  │   Gateway    │  │   Browser    │  │  Docker   │ │
│  │  (Port 18789)│  │ (Port 18791) │  │  Sandbox  │ │
│  └──────┬───────┘  └──────────────┘  └───────────┘ │
│         │                                           │
│         ├─> WhatsApp                                │
│         ├─> Telegram                                │
│         ├─> Discord                                 │
│         └─> Web UI                                  │
└─────────────────────────────────────────────────────┘
           ↑
           │ Tailscale VPN (Encrypted)
           │
     ┌─────┴──────┐
     │ Your Devices│
     └────────────┘
```

**Components:**
1. **Gateway (Port 18789):** WebSocket server handling all messaging and coordination
2. **Browser Control (Port 18791):** Headless Chrome for web automation
3. **Docker Sandbox:** Isolated environment for running tools and commands

---

## Setup Method 1: Pulumi

### Why Pulumi?

- **Reproducible:** One `pulumi up` command deploys everything
- **Version Control:** Your infrastructure is code
- **Easy Teardown:** `pulumi destroy` removes everything cleanly
- **No Console Clicking:** Automated, repeatable deployments

### Step 1: Set Up Pulumi ESC (Secrets Management)

```bash
# Install Pulumi CLI
curl -fsSL https://get.pulumi.com | sh

# Create a new ESC environment for secrets
pulumi env init <your-org>/moltbot-secrets
```

Edit the environment to add your secrets:

```yaml
values:
  anthropicApiKey:
    fn::secret: "sk-ant-xxxxx"
  tailscaleAuthKey:
    fn::secret: "tskey-auth-xxxxx"
  tailnetDnsName: "tailxxxxx.ts.net"
  pulumiConfig:
    anthropicApiKey: ${anthropicApiKey}
    tailscaleAuthKey: ${tailscaleAuthKey}
    tailnetDnsName: ${tailnetDnsName}
```

**Finding Your Tailnet DNS Name:**
1. Go to [Tailscale Admin Console](https://login.tailscale.com/admin/dns)
2. Look under **DNS** section
3. Find your tailnet name (e.g., `tailxxxxx.ts.net`)

### Step 2: Create Pulumi Project

```bash
mkdir moltbot-aws && cd moltbot-aws
pulumi new typescript
npm install @pulumi/aws @pulumi/tls
```

### Step 3: Configure Pulumi Stack

Create `Pulumi.dev.yaml`:

```yaml
environment:
  - <your-org>/moltbot-secrets
config:
  aws:region: us-east-1
  moltbot-aws:instanceType: t3.medium
  moltbot-aws:gatewayPort: 18789
  moltbot-aws:browserPort: 18791
```

### Step 4: Create Pulumi Program

Replace `index.ts` with the complete Pulumi program from the first documentation (I can provide this in a separate file if needed).

Key features of the Pulumi program:
- Creates VPC, subnets, and security groups
- Generates SSH keys automatically
- Installs Docker, Node.js, and MoltBot via cloud-init
- Configures Tailscale for secure access
- Runs automated onboarding
- Outputs Tailscale URL with gateway token

### Step 5: Deploy

```bash
pulumi up
```

Review the changes and confirm. After deployment (5-10 minutes), you'll see:

```
Outputs:
    gatewayTokenOutput   : "786c099cc8f8bf20..."
    publicIp             : "x.x.x.x"
    tailscaleUrl         : "https://ip-10-0-1-x.tailxxxxx.ts.net/"
    tailscaleUrlWithToken: "https://ip-10-0-1-x.tailxxxxx.ts.net/?token=786c099..."
```

### Step 6: Access MoltBot

1. Copy the `tailscaleUrlWithToken` from outputs
2. Paste into your browser (you must be connected to your Tailnet)
3. The token authenticates you automatically

---

## Setup Method 2: Bash Script

### For Those Who Prefer Manual Control

If you don't want to use Pulumi but still want automation, use this bash script approach.

### Step 1: Launch EC2 Instance Manually

1. Go to AWS Console → EC2
2. Click "Launch Instance"
3. Configure:
   - **AMI:** Ubuntu 24.04 LTS
   - **Instance Type:** t3.medium or larger
   - **Storage:** 30GB gp3
   - **Security Group:** 
     ```
     SSH (22) - Your IP
     Custom TCP (18789) - 0.0.0.0/0 (temporary, will secure later)
     Custom TCP (18791) - 0.0.0.0/0 (temporary, will secure later)
     ```
   - **Key Pair:** Create or select existing

4. Launch and note the public IP

### Step 2: Create Installation Script

Save this as `install-moltbot.sh`:

```bash
#!/bin/bash
set -e

# Configuration
ANTHROPIC_API_KEY="your-api-key-here"
TAILSCALE_AUTH_KEY="your-tailscale-key-here"
GATEWAY_PORT=18789
BROWSER_PORT=18791

echo "======================================"
echo "  MoltBot Installation Script"
echo "======================================"

export DEBIAN_FRONTEND=noninteractive

# Update system
echo "[1/7] Updating system packages..."
sudo apt-get update
sudo apt-get upgrade -y

# Install Docker
echo "[2/7] Installing Docker..."
curl -fsSL https://get.docker.com | sh
sudo systemctl enable docker
sudo systemctl start docker
sudo usermod -aG docker ubuntu

# Install NVM and Node.js
echo "[3/7] Installing Node.js via NVM..."
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash

# Load NVM
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"

# Install Node.js 22
nvm install 22
nvm use 22
nvm alias default 22

# Add NVM to bashrc
if ! grep -q 'NVM_DIR' ~/.bashrc; then
    echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.bashrc
    echo '[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"' >> ~/.bashrc
fi

# Install MoltBot
echo "[4/7] Installing MoltBot..."
npm install -g moltbot@beta

# Set environment variables
echo "export ANTHROPIC_API_KEY=\"$ANTHROPIC_API_KEY\"" >> ~/.bashrc
source ~/.bashrc

# Install and configure Tailscale
echo "[5/7] Installing Tailscale..."
curl -fsSL https://tailscale.com/install.sh | sh
sudo tailscale up --authkey="$TAILSCALE_AUTH_KEY" --ssh

# Enable systemd linger for user services
echo "[6/7] Configuring systemd..."
sudo loginctl enable-linger ubuntu

# Run MoltBot onboarding
echo "[7/7] Running MoltBot onboarding..."
export ANTHROPIC_API_KEY="$ANTHROPIC_API_KEY"
export GATEWAY_PORT="$GATEWAY_PORT"

moltbot onboard --non-interactive --accept-risk \
    --mode local \
    --auth-choice apiKey \
    --gateway-port $GATEWAY_PORT \
    --gateway-bind loopback \
    --skip-daemon \
    --skip-skills

# Install daemon
export XDG_RUNTIME_DIR=/run/user/$(id -u)
moltbot daemon install

# Generate gateway token
GATEWAY_TOKEN=$(openssl rand -hex 24)

# Configure gateway
python3 << PYTHON_SCRIPT
import json
import os

config_path = os.path.expanduser("~/.moltbot/moltbot.json")
with open(config_path) as f:
    config = json.load(f)

config["gateway"]["trustedProxies"] = ["127.0.0.1"]
config["gateway"]["controlUi"] = {
    "enabled": True,
    "allowInsecureAuth": True
}
config["gateway"]["auth"] = {
    "mode": "token",
    "token": os.environ["GATEWAY_TOKEN"]
}

with open(config_path, "w") as f:
    json.dump(config, f, indent=2)
PYTHON_SCRIPT

# Enable Tailscale HTTPS proxy
sudo tailscale serve --bg $GATEWAY_PORT

echo ""
echo "======================================"
echo "  Installation Complete!"
echo "======================================"
echo ""
echo "Gateway Token: $GATEWAY_TOKEN"
echo ""
echo "Find your Tailscale hostname at:"
echo "https://login.tailscale.com/admin/machines"
echo ""
echo "Access MoltBot at:"
echo "https://your-machine-name.your-tailnet.ts.net/?token=$GATEWAY_TOKEN"
echo ""
```

### Step 3: Run Installation

```bash
# SSH into your instance
ssh -i your-key.pem ubuntu@your-ec2-ip

# Edit the script with your actual keys
nano install-moltbot.sh

# Make executable
chmod +x install-moltbot.sh

# Run
./install-moltbot.sh
```

The script will take 5-10 minutes. At the end, it displays your gateway token and instructions.

---

## Setup Method 3: Terraform

### For Infrastructure-as-Code Without Pulumi

If you prefer Terraform over Pulumi, here's the equivalent setup.

### Step 1: Create Terraform Project

```bash
mkdir moltbot-terraform && cd moltbot-terraform
```

### Step 2: Create `main.tf`

```hcl
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
    tls = {
      source  = "hashicorp/tls"
      version = "~> 4.0"
    }
  }
}

provider "aws" {
  region = var.aws_region
}

# Variables
variable "aws_region" {
  default = "us-east-1"
}

variable "instance_type" {
  default = "t3.medium"
}

variable "anthropic_api_key" {
  sensitive = true
}

variable "tailscale_auth_key" {
  sensitive = true
}

variable "tailnet_dns_name" {
  description = "Your Tailscale tailnet DNS name (e.g., tailxxxxx.ts.net)"
}

variable "gateway_port" {
  default = 18789
}

variable "browser_port" {
  default = 18791
}

# Generate SSH key
resource "tls_private_key" "moltbot_ssh" {
  algorithm = "ED25519"
}

# Generate gateway token
resource "random_id" "gateway_token" {
  byte_length = 24
}

# VPC
resource "aws_vpc" "moltbot" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    Name = "moltbot-vpc"
  }
}

# Internet Gateway
resource "aws_internet_gateway" "moltbot" {
  vpc_id = aws_vpc.moltbot.id

  tags = {
    Name = "moltbot-igw"
  }
}

# Subnet
resource "aws_subnet" "moltbot" {
  vpc_id                  = aws_vpc.moltbot.id
  cidr_block              = "10.0.1.0/24"
  map_public_ip_on_launch = true

  tags = {
    Name = "moltbot-subnet"
  }
}

# Route Table
resource "aws_route_table" "moltbot" {
  vpc_id = aws_vpc.moltbot.id

  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = aws_internet_gateway.moltbot.id
  }

  tags = {
    Name = "moltbot-rt"
  }
}

resource "aws_route_table_association" "moltbot" {
  subnet_id      = aws_subnet.moltbot.id
  route_table_id = aws_route_table.moltbot.id
}

# Security Group
resource "aws_security_group" "moltbot" {
  name        = "moltbot-sg"
  description = "Security group for MoltBot instance"
  vpc_id      = aws_vpc.moltbot.id

  # SSH access (fallback)
  ingress {
    description = "SSH access"
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  # All outbound traffic
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name = "moltbot-sg"
  }
}

# Key Pair
resource "aws_key_pair" "moltbot" {
  key_name   = "moltbot-key"
  public_key = tls_private_key.moltbot_ssh.public_key_openssh
}

# Get latest Ubuntu AMI
data "aws_ami" "ubuntu" {
  most_recent = true
  owners      = ["099720109477"] # Canonical

  filter {
    name   = "name"
    values = ["ubuntu/images/hvm-ssd-gp3/ubuntu-noble-24.04-amd64-server-*"]
  }

  filter {
    name   = "virtualization-type"
    values = ["hvm"]
  }
}

# User data script
locals {
  user_data = templatefile("${path.module}/user-data.sh", {
    anthropic_api_key  = var.anthropic_api_key
    tailscale_auth_key = var.tailscale_auth_key
    gateway_port       = var.gateway_port
    browser_port       = var.browser_port
    gateway_token      = random_id.gateway_token.hex
  })
}

# EC2 Instance
resource "aws_instance" "moltbot" {
  ami                    = data.aws_ami.ubuntu.id
  instance_type          = var.instance_type
  subnet_id              = aws_subnet.moltbot.id
  vpc_security_group_ids = [aws_security_group.moltbot.id]
  key_name               = aws_key_pair.moltbot.key_name
  user_data              = local.user_data
  user_data_replace_on_change = true

  root_block_device {
    volume_size = 30
    volume_type = "gp3"
  }

  tags = {
    Name = "moltbot"
  }
}

# Outputs
output "public_ip" {
  value = aws_instance.moltbot.public_ip
}

output "public_dns" {
  value = aws_instance.moltbot.public_dns
}

output "private_key" {
  value     = tls_private_key.moltbot_ssh.private_key_openssh
  sensitive = true
}

output "gateway_token" {
  value     = random_id.gateway_token.hex
  sensitive = true
}

output "tailscale_hostname" {
  value = "ip-${replace(aws_instance.moltbot.private_ip, ".", "-")}"
}

output "tailscale_url" {
  value = "https://ip-${replace(aws_instance.moltbot.private_ip, ".", "-")}.${var.tailnet_dns_name}/"
}

output "tailscale_url_with_token" {
  value     = "https://ip-${replace(aws_instance.moltbot.private_ip, ".", "-")}.${var.tailnet_dns_name}/?token=${random_id.gateway_token.hex}"
  sensitive = true
}
```

### Step 3: Create `user-data.sh`

```bash
#!/bin/bash
set -e

export DEBIAN_FRONTEND=noninteractive

# System updates
apt-get update
apt-get upgrade -y

# Install Docker
curl -fsSL https://get.docker.com | sh
systemctl enable docker
systemctl start docker
usermod -aG docker ubuntu

# Install NVM and Node.js for ubuntu user
sudo -u ubuntu bash << 'UBUNTU_SCRIPT'
set -e
cd ~

# Install NVM
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash

# Load NVM
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"

# Install Node.js 22
nvm install 22
nvm use 22
nvm alias default 22

# Install MoltBot
npm install -g moltbot@beta

# Add NVM to bashrc
if ! grep -q 'NVM_DIR' ~/.bashrc; then
    echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.bashrc
    echo '[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"' >> ~/.bashrc
fi
UBUNTU_SCRIPT

# Set environment variables
echo 'export ANTHROPIC_API_KEY="${anthropic_api_key}"' >> /home/ubuntu/.bashrc

# Install and configure Tailscale
echo "Installing Tailscale..."
curl -fsSL https://tailscale.com/install.sh | sh
tailscale up --authkey="${tailscale_auth_key}" --ssh || echo "WARNING: Tailscale setup failed"

# Enable systemd linger
loginctl enable-linger ubuntu
systemctl start user@1000.service

# Run MoltBot onboarding
echo "Running MoltBot onboarding..."
sudo -H -u ubuntu ANTHROPIC_API_KEY="${anthropic_api_key}" GATEWAY_PORT="${gateway_port}" bash -c '
export HOME=/home/ubuntu
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"

moltbot onboard --non-interactive --accept-risk \
    --mode local \
    --auth-choice apiKey \
    --gateway-port $GATEWAY_PORT \
    --gateway-bind loopback \
    --skip-daemon \
    --skip-skills || echo "WARNING: Onboarding failed"
'

# Install daemon
echo "Installing MoltBot daemon..."
sudo -H -u ubuntu XDG_RUNTIME_DIR=/run/user/1000 bash -c '
export HOME=/home/ubuntu
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"

moltbot daemon install || echo "WARNING: Daemon install failed"
'

# Configure gateway
echo "Configuring gateway..."
sudo -H -u ubuntu GATEWAY_TOKEN="${gateway_token}" python3 << 'PYTHON_SCRIPT'
import json
import os

config_path = "/home/ubuntu/.moltbot/moltbot.json"
with open(config_path) as f:
    config = json.load(f)

config["gateway"]["trustedProxies"] = ["127.0.0.1"]
config["gateway"]["controlUi"] = {
    "enabled": True,
    "allowInsecureAuth": True
}
config["gateway"]["auth"] = {
    "mode": "token",
    "token": os.environ["GATEWAY_TOKEN"]
}

with open(config_path, "w") as f:
    json.dump(config, f, indent=2)
PYTHON_SCRIPT

# Enable Tailscale HTTPS proxy
echo "Enabling Tailscale HTTPS proxy..."
tailscale serve --bg ${gateway_port} || echo "WARNING: tailscale serve failed"

echo "MoltBot setup complete!"
```

### Step 4: Create `terraform.tfvars`

```hcl
aws_region         = "us-east-1"
instance_type      = "t3.medium"
anthropic_api_key  = "sk-ant-your-key-here"
tailscale_auth_key = "tskey-auth-your-key-here"
tailnet_dns_name   = "tailxxxxx.ts.net"
gateway_port       = 18789
browser_port       = 18791
```

### Step 5: Deploy with Terraform

```bash
# Initialize
terraform init

# Plan
terraform plan

# Apply
terraform apply

# Get outputs
terraform output tailscale_url_with_token
```

---

## Security Best Practices

### 1. Never Expose Ports Publicly

❌ **BAD:** Opening ports 18789 and 18791 to 0.0.0.0/0  
✅ **GOOD:** Using Tailscale for all gateway access

### 2. Secure Your Gateway Token

```bash
# Store in password manager
# Never commit to git
# Rotate periodically
```

### 3. Use Tailscale SSH

```bash
# After Tailscale is configured, remove SSH ingress rule
# Access via: ssh ubuntu@tailscale-hostname
```

### 4. Firewall Configuration

If using AWS Security Groups:

```yaml
Inbound Rules:
  - SSH (22): Your IP only (temporary)
  # Remove after Tailscale SSH works

Outbound Rules:
  - All traffic: 0.0.0.0/0 (required for API calls)
```

### 5. API Key Rotation

- Rotate Anthropic API keys monthly
- Never share API keys
- Monitor API usage in Anthropic console

### 6. Monitor for Exposed Instances

Don't be this person:

```bash
# Check if your instance is exposed
shodan search "moltbot port:18789"
```

If you find your instance here, immediately:
1. Remove security group rules
2. Set up Tailscale
3. Rotate gateway token

---

## Connecting to WhatsApp

### Prerequisites

- MoltBot running and accessible
- WhatsApp Business Account
- Meta Business Suite access

### Method 1: WhatsApp Cloud API (Recommended)

This is the official Meta solution for business messaging.

#### Step 1: Set Up Meta App

1. Go to [Meta for Developers](https://developers.facebook.com/)
2. Create a new app or use existing
3. Add WhatsApp product to your app
4. Navigate to WhatsApp → Getting Started

#### Step 2: Get Credentials

You'll need:
- **Phone Number ID** (from WhatsApp → Getting Started)
- **WhatsApp Business Account ID**
- **Permanent Access Token** (requires business verification)
- **Webhook Verify Token** (you create this)

#### Step 3: Configure in MoltBot

SSH into your instance:

```bash
ssh ubuntu@your-tailscale-hostname

# Add WhatsApp provider
moltbot providers add whatsapp-cloud \
  --phone-number-id "YOUR_PHONE_NUMBER_ID" \
  --access-token "YOUR_ACCESS_TOKEN" \
  --business-account-id "YOUR_BUSINESS_ACCOUNT_ID"
```

#### Step 4: Set Up Webhook

Meta needs to verify your webhook. In MoltBot web UI:

1. Go to **Settings** → **Providers** → **WhatsApp**
2. Note your webhook URL (will be like `https://your-instance.ts.net/webhook/whatsapp`)
3. In Meta dashboard:
   - Go to WhatsApp → Configuration
   - Add webhook URL
   - Set Verify Token (create a random string)
   - Subscribe to messages

#### Step 5: Verify Setup

Send a message from WhatsApp to your business number. MoltBot should respond!

### Method 2: WhatsApp Web (Unofficial - Easier Setup)

This method uses web.whatsapp.com and is easier but less reliable.

⚠️ **Warning:** This is against WhatsApp ToS and your number may be banned.

#### Using whatsapp-web.js

Install the WhatsApp Web provider:

```bash
# SSH into instance
ssh ubuntu@your-tailscale-hostname

# Install whatsapp-web.js provider
cd ~/.moltbot/skills
git clone https://github.com/moltbot/skill-whatsapp-web.git

# Restart MoltBot
systemctl --user restart moltbot-gateway
```

#### Scan QR Code

1. Access MoltBot Web UI
2. Go to **Providers** → **WhatsApp Web**
3. Click **Connect**
4. Scan QR code with your phone (WhatsApp → Linked Devices)

### Method 3: Twilio WhatsApp (For Testing)

Good for testing before committing to Meta setup.

#### Step 1: Set Up Twilio

1. Sign up at [twilio.com](https://www.twilio.com)
2. Go to Messaging → Try it out → Send a WhatsApp message
3. Note your:
   - Account SID
   - Auth Token
   - WhatsApp number (starts with +14155238886 for sandbox)

#### Step 2: Configure MoltBot

```bash
moltbot providers add twilio \
  --account-sid "YOUR_ACCOUNT_SID" \
  --auth-token "YOUR_AUTH_TOKEN" \
  --whatsapp-number "+14155238886"
```

#### Step 3: Join Sandbox

1. Send "join [your-sandbox-keyword]" to the Twilio WhatsApp number
2. Test by sending a message

### Comparison

| Method | Difficulty | Cost | Reliability | ToS Compliant |
|--------|-----------|------|-------------|---------------|
| Cloud API | Hard | Free (with limits) | Excellent | ✅ Yes |
| Web.js | Easy | Free | Medium | ❌ No |
| Twilio | Medium | Pay per message | Good | ✅ Yes |

**Recommendation:** Start with Twilio for testing, migrate to Cloud API for production.

---

## Post-Deployment Management

### Daily Operations

#### Check Status

```bash
# Via systemd
systemctl --user status moltbot-gateway

# Via logs
journalctl --user -u moltbot-gateway -f
```

#### View Logs

```bash
# Last 100 lines
moltbot logs --tail 100

# Follow logs
moltbot logs -f

# Filter errors
moltbot logs | grep ERROR
```

#### Restart Service

```bash
systemctl --user restart moltbot-gateway
```

### Weekly Maintenance

#### Monitor Resource Usage

```bash
# Check memory and CPU
htop

# Check disk space
df -h

# Check MoltBot-specific usage
docker stats moltbot-gateway 2>/dev/null || top
```

#### Review Logs for Errors

```bash
moltbot logs --since 7d | grep -i error
```

### Monthly Maintenance

#### Update MoltBot

```bash
# Pull latest version
npm update -g moltbot@beta

# Restart service
systemctl --user restart moltbot-gateway
```

#### Rotate API Keys

1. Generate new Anthropic API key
2. Update in `~/.moltbot/moltbot.json`
3. Restart gateway
4. Revoke old key

#### Review Security

- Check Tailscale devices for unauthorized access
- Review gateway access logs
- Verify firewall rules haven't changed

### Backup Strategy

#### What to Backup

```bash
# Configuration
~/.moltbot/moltbot.json

# Conversation history (if stored)
~/.moltbot/data/

# Environment variables
~/.moltbot/.env
```

#### Automated Backup Script

```bash
#!/bin/bash
BACKUP_DIR="/home/ubuntu/moltbot-backups"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR
tar -czf $BACKUP_DIR/moltbot-backup-$DATE.tar.gz \
    ~/.moltbot/

# Keep only last 7 backups
ls -t $BACKUP_DIR/*.tar.gz | tail -n +8 | xargs rm -f
```

Add to crontab:

```bash
crontab -e
# Add: 0 2 * * * /home/ubuntu/backup-moltbot.sh
```

---

## Troubleshooting

### Common Issues

#### 1. Installation Fails - Out of Memory

**Symptom:**
```
npm install killed
Process killed
```

**Solution:** You used t3.micro. Upgrade to t3.medium:

```bash
# Stop instance
# Change instance type to t3.medium in AWS console
# Start instance
# Re-run installation
```

#### 2. Gateway Won't Start

**Symptom:**
```
systemctl --user status moltbot-gateway
● moltbot-gateway.service - failed
```

**Check logs:**
```bash
journalctl --user -u moltbot-gateway -n 50
```

**Common causes:**
- Missing ANTHROPIC_API_KEY
- Port 18789 already in use
- Invalid configuration JSON

**Solution:**
```bash
# Verify API key
grep ANTHROPIC_API_KEY ~/.bashrc

# Check port usage
sudo lsof -i :18789

# Validate config
python3 -m json.tool ~/.moltbot/moltbot.json
```

#### 3. Can't Access Web UI

**Symptom:** Tailscale URL doesn't load

**Checklist:**
- [ ] Instance is running
- [ ] Gateway service is active
- [ ] You're connected to Tailscale network
- [ ] HTTPS is enabled in Tailscale admin console
- [ ] `tailscale serve` is running

**Debugging:**
```bash
# Check if gateway is listening
curl http://localhost:18789

# Check Tailscale status
sudo tailscale status

# Verify serve is active
sudo tailscale serve status

# Restart serve
sudo tailscale serve --bg 18789
```

#### 4. Authentication Errors

**Symptom:**
```
Invalid API key
Authentication failed
```

**Verify API key:**
```bash
# Test key directly
curl https://api.anthropic.com/v1/messages \
  -H "x-api-key: $ANTHROPIC_API_KEY" \
  -H "anthropic-version: 2023-06-01" \
  -H "content-type: application/json" \
  -d '{"model":"claude-sonnet-4","max_tokens":1024,"messages":[{"role":"user","content":"test"}]}'
```

**If key is invalid:**
1. Generate new key in Anthropic console
2. Update `~/.moltbot/moltbot.json`
3. Export to environment: `export ANTHROPIC_API_KEY="new-key"`
4. Restart gateway

#### 5. WhatsApp Connection Fails

**For Cloud API:**
```bash
# Verify webhook
curl -X POST https://your-instance.ts.net/webhook/whatsapp \
  -H "Content-Type: application/json" \
  -d '{"test": "webhook"}'
```

**For Web.js:**
- QR code expired → Regenerate in UI
- Session invalidated → Clear `~/.moltbot/waweb/` and reconnect

#### 6. Container Restart Loops

**Symptom:** Gateway keeps restarting

**Check why:**
```bash
moltbot logs --tail 200
```

**Common causes:**
- Corrupted config file
- Missing dependencies
- Permission issues

**Nuclear option:**
```bash
# Backup config
cp ~/.moltbot/moltbot.json ~/moltbot-config-backup.json

# Remove and reinstall
npm uninstall -g moltbot
rm -rf ~/.moltbot
npm install -g moltbot@beta

# Restore config
cp ~/moltbot-config-backup.json ~/.moltbot/moltbot.json

# Reinstall daemon
moltbot daemon install
```

### Getting Help

If you're stuck:

1. **Check logs first:**
   ```bash
   moltbot logs --tail 500 > ~/moltbot-error.log
   ```

2. **Search GitHub Issues:**
   [github.com/moltbot/moltbot/issues](https://github.com/moltbot/moltbot/issues)

3. **Discord Community:**
   Join the MoltBot Discord for real-time help

4. **Include in bug reports:**
   - MoltBot version: `moltbot --version`
   - OS version: `lsb_release -a`
   - Error logs
   - Steps to reproduce

---

## Cost Optimization

### AWS Costs (Monthly Estimates)

```yaml
t3.medium (On-Demand):
  Compute: ~$30/month
  Storage (30GB gp3): ~$2.40/month
  Data Transfer (typical): ~$5/month
  Total: ~$37/month

Savings Options:
  1. Reserved Instance (1 year): Save ~40% → $23/month
  2. Savings Plan: Save ~30% → $26/month
  3. Spot Instance: Save ~70% → $11/month (may be interrupted)
```

### Alternative: Hetzner Cloud

```yaml
CAX21 (ARM-based):
  4 vCPUs: 8GB RAM
  Cost: €6.49/month (~$7)
  Savings vs AWS: ~80%

Trade-offs:
  - European data center only
  - ARM architecture (works fine for MoltBot)
  - Different provider ecosystem
```

### Free Tier Options

For testing only (insufficient for production):

```yaml
AWS t2.micro (Free Tier):
  ❌ Only 1GB RAM - MoltBot won't run
  
Oracle Cloud (Free Forever):
  ✅ Up to 4 ARM cores, 24GB RAM
  ✅ Sufficient for MoltBot
  ⚠️ May have availability issues in some regions
```

---

## Advanced Configuration

### Custom Skills

MoltBot supports custom skills for extending functionality.

#### Create Custom Skill

```bash
cd ~/.moltbot/skills
mkdir my-custom-skill
cd my-custom-skill
```

Create `skill.json`:

```json
{
  "name": "my-custom-skill",
  "description": "My awesome skill",
  "version": "1.0.0",
  "tools": [
    {
      "name": "custom_tool",
      "description": "Does something cool",
      "parameters": {
        "type": "object",
        "properties": {
          "input": {
            "type": "string",
            "description": "Input data"
          }
        }
      }
    }
  ]
}
```

Create `index.js`:

```javascript
module.exports = {
  async custom_tool({ input }) {
    // Your logic here
    return `Processed: ${input}`;
  }
};
```

Reload skills:

```bash
systemctl --user restart moltbot-gateway
```

### Environment Variables

Common environment variables in `~/.moltbot/.env`:

```bash
# Required
ANTHROPIC_API_KEY=sk-ant-xxxxx

# Optional
MOLTBOT_LOG_LEVEL=info
MOLTBOT_GATEWAY_PORT=18789
MOLTBOT_BROWSER_PORT=18791
MOLTBOT_DATA_DIR=/home/ubuntu/.moltbot/data
```

### Multiple Messaging Channels

Connect multiple platforms simultaneously:

```bash
# Telegram
moltbot providers add telegram --token "YOUR_BOT_TOKEN"

# Discord
moltbot providers add discord --token "YOUR_BOT_TOKEN"

# Slack
moltbot providers add slack --token "YOUR_BOT_TOKEN"

# Signal (requires signal-cli)
moltbot providers add signal --number "+1234567890"
```

---

## Conclusion

You now have three ways to deploy MoltBot on EC2:

1. **Pulumi** - Best for reproducible, version-controlled infrastructure
2. **Bash Script** - Best for quick manual deployment
3. **Terraform** - Best for existing Terraform workflows

**Key Takeaways:**

✅ Always use Tailscale for secure access  
✅ Never use t3.micro - minimum t3.medium  
✅ Store secrets in environment variables or ESC  
✅ Monitor logs and resource usage  
✅ Keep API keys secure and rotated  

**Next Steps:**

1. Deploy using your preferred method
2. Connect to WhatsApp or other platforms
3. Install custom skills as needed
4. Set up automated backups
5. Monitor and maintain regularly

---

## Additional Resources

### Official Documentation

- [MoltBot Official Docs](https://docs.molt.bot/)
- [Pulumi AWS Guide](https://www.pulumi.com/registry/packages/aws/)
- [Terraform AWS Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [Tailscale Documentation](https://tailscale.com/kb/)

### Community

- [MoltBot GitHub](https://github.com/moltbot/moltbot)
- [MoltBot Discord](https://discord.gg/moltbot)
- [Pulumi Slack](https://slack.pulumi.com/)

### Security

- [AWS Security Best Practices](https://docs.aws.amazon.com/security/)
- [Tailscale Security Model](https://tailscale.com/blog/tailscale-security/)
- [Anthropic API Security](https://docs.anthropic.com/claude/docs/security)

---

**Document Version:** 1.0  
**Last Updated:** January 30, 2026  
**Feedback:** Open an issue on GitHub or contact via email

---

*This guide is based on official Pulumi and Hostinger documentation, combined with AWS and security best practices. Always refer to official documentation for the most up-to-date information.*